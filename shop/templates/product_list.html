{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block body_class %}product-list-page{% endblock %}
{% load static %}
{% block content %}

<section class="shop-section py-5">
  <div class="container">

    <!--  Header: Title + Search + Sort  -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-5 gap-3">
      <h2 class="fw-bold mb-0">Discover Premium Leather Products</h2>

      <div class="d-flex align-items-center gap-3">
        <!-- Search Form -->
        <form method="get" class="d-flex align-items-center" style="max-width: 300px;">
          <input type="text" name="q" class="form-control shadow-sm" placeholder="Search products..." value="{{ query }}">
          <button class="btn btn-dark ms-2" type="submit">
            <i class="bi bi-search"></i>
          </button>
        </form>

        <!-- Sort Dropdown -->
      <form method="get" id="sort-form">
        <select name="sort" class="form-select shadow-sm border-0" style="width: 180px;" onchange="document.getElementById('sort-form').submit()">
          <option disabled {% if not sort_option %}selected{% endif %}>Sort By</option>
          <option value="latest" {% if sort_option == 'latest' %}selected{% endif %}>Newest</option>
          <option value="low-high" {% if sort_option == 'low-high' %}selected{% endif %}>Price: Low → High</option>
          <option value="high-low" {% if sort_option == 'high-low' %}selected{% endif %}>Price: High → Low</option>
          <option value="featured" {% if sort_option == 'featured' %}selected{% endif %}>Featured</option>
        </select>
      </form>
      </div>
    </div>

    <div class="row">

      <!--  Sidebar: Filters -->
      <aside class="col-lg-3 mb-5 mb-lg-0">
        <div class="p-4 bg-light rounded-4 shadow-sm">

          <!-- Category Filter -->
          <div class="mb-5">
            <h5 class="fw-semibold mb-3">Categories</h5>
            <ul class="list-unstyled">
              {% for cat in categories %}
              <li class="mb-2">
                <a href="?category={{ cat.slug }}" class="text-decoration-none text-dark d-flex justify-content-between align-items-center">
                  <span>{{ cat.name }}</span>
                  <i class="bi bi-chevron-right small text-muted"></i>
                </a>
              </li>
              {% empty %}
              <li class="text-muted">No categories found.</li>
              {% endfor %}
            </ul>
          </div>

          <!-- Price Filter -->
          <div class="mb-5">
            <h5 class="fw-semibold mb-3">Price Range</h5>
            <form method="get">
              <div class="input-group mb-2">
                <span class="input-group-text">$</span>
                <input type="number" name="min_price" class="form-control"
                      placeholder="Min" value="{{ min_price }}">
              </div>
              <div class="input-group mb-3">
                <span class="input-group-text">$</span>
                <input type="number" name="max_price" class="form-control"
                      placeholder="Max" value="{{ max_price }}">
              </div>
              <button type="submit" class="btn btn-dark btn-sm w-100">Apply</button>
            </form>
          </div>

          <!-- Featured Picks -->
          <div>
            <h5 class="fw-semibold mb-3">Featured Picks</h5>
            {% for fp in featured_products %}
            <div class="d-flex align-items-center mb-3">
              <img src="{{ fp.images.first.image.url }}" alt="{{ fp.name }}" class="rounded me-3" style="width: 60px; height: 60px; object-fit: cover;">
              <div>
                <p class="fw-semibold mb-0">{{ fp.name|truncatechars:22 }}</p>
                <small class="text-muted">${{ fp.price }}</small>
              </div>
            </div>
            {% empty %}
            <p class="text-muted small">No featured products.</p>
            {% endfor %}
          </div>

        </div>
      </aside>

      <!--   Main Product Grid   -->
    <div class="col-lg-9">
        <div id="product-container">
        {% include 'includes/_product_grid.html' %}
        </div>
    </div>
    </div>

</section>


{% endblock %}

