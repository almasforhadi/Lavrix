{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load crispy_forms_tags %}
{% block body_class %}product-detail-page{% endblock %}
{% block content %}

<section class="product-detail py-5">
  <div class="container">
    <div class="row g-4">

      <!-- Product Images -->
      <div class="col-lg-6">
        <div class="product-images position-relative">
          {% if product.images.all %}
          <img id="mainImage" src="{{ product.images.first.image.url }}" class="img-fluid rounded-4 shadow-sm mb-3" alt="{{ product.name }}">
          <div class="d-flex gap-2 flex-wrap">
            {% for img in product.images.all %}
            <img src="{{ img.image.url }}" class="img-thumbnail rounded-3 thumb-image" style="width:80px; cursor:pointer;" alt="{{ product.name }}">
            {% endfor %}
          </div>
          {% else %}
          <img src="{% static 'images/no-image.jpg' %}" class="img-fluid rounded-4 shadow-sm" alt="No Image">
          {% endif %}
        </div>
      </div>

      <!-- Product Info -->
      <div class="col-lg-6">
        <h1 class="fw-bold mb-3">{{ product.name }}</h1>

        <p class="text-muted mb-2">Category: 
          <a href="{% url 'shop:category_list' %}" class="text-decoration-none">{{ product.category.name }}</a>
        </p>

        <!-- Price -->
        <div class="mb-3">
          {% if product.sale_price %}
          <span class="text-decoration-line-through text-muted fs-5">${{ product.price }}</span>
          <span class="fs-4 text-danger fw-bold ms-2">${{ product.sale_price }}</span>
          {% else %}
          <span class="fs-4 fw-bold text-dark">${{ product.price }}</span>
          {% endif %}
        </div>

        <!-- Stock -->
        {% if product.stock > 0 %}
        <p class="text-success fw-semibold">In Stock ({{ product.stock }})</p>
        {% else %}
        <p class="text-danger fw-semibold">Out of Stock</p>
        {% endif %}

        <!-- Material & Care -->
        {% if product.material %}
        <p><strong>Material:</strong> {{ product.material }}</p>
        {% endif %}
        {% if product.care %}
        <p><strong>Care Instructions:</strong> {{ product.care }}</p>
        {% endif %}

        <!-- Description -->
        <p class="mt-3">{{ product.description }}</p>

        {% if request.user.is_authenticated %}
          <a href="#" class="btn btn-outline-dark btn-sm btn-add-cart" data-id="{{ product.id }}">Add to Cart</a>
        {% else %}
          <button class="btn btn-outline-dark btn-sm btn-show-login-modal">Add to Cart</button>
        {% endif %}


      </div>
    </div>

    <!-- Related Products -->
    {% if related_products %}
    <div class="related-products mt-5">
      <h3 class="fw-bold mb-4">You May Also Like :</h3>
      <div class="row g-4">
        {% for p in related_products %}
        <div class="col-md-3">
          <div class="card h-100 shadow-sm rounded-4 overflow-hidden">
            {% if p.images.first %}
            <img src="{{ p.images.first.image.url }}" class="card-img-top" style="height:200px; object-fit:cover;" alt="{{ p.name }}">
            {% else %}
            <img src="{% static 'images/no-image.jpg' %}" class="card-img-top" style="height:200px; object-fit:cover;" alt="No Image">
            {% endif %}
            <div class="card-body text-center">
              <h6 class="fw-semibold">{{ p.name }}</h6>
              {% if p.sale_price %}
              <p>
                <span class="text-decoration-line-through text-muted">${{ p.price }}</span>
                <span class="text-danger fw-semibold ms-1">${{ p.sale_price }}</span>
              </p>
              {% else %}
              <p class="fw-semibold text-dark mb-1">${{ p.price }}</p>
              {% endif %}
              <a href="{% url 'shop:product_detail' p.slug %}" class="btn btn-outline-dark btn-sm mt-2">View Details</a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>



</section>

<!-- Optional JS for Thumbnail Click -->
<script>
  const mainImage = document.getElementById("mainImage");
  const thumbnails = document.querySelectorAll(".thumb-image");

  thumbnails.forEach(img => {
    img.addEventListener("click", () => {
      mainImage.src = img.src;
    });
  });
  
</script>

{% endblock %}