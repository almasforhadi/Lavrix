{% extends 'base.html' %}
{% block title %}User Dashboard | Lavrix{% endblock %}
{% block body_class %}dashboard-page{% endblock %}
{% load static %}
{% block content %}
<!-- Django Messages -->
{% if messages %}
  <div id="django-messages" class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 2000; width: 90%; max-width: 600px;">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-lg rounded-3 py-2 px-3" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<script>
  setTimeout(() => {
    const alerts = document.querySelectorAll('#django-messages .alert');
    alerts.forEach(alert => bootstrap.Alert.getOrCreateInstance(alert).close());
  }, 5000);
</script>



<div class="dashboard d-flex flex-column flex-lg-row min-vh-100">

  <!-- SIDEBAR -->
  <aside class="sidebar shadow-sm p-4 d-flex flex-column justify-content-between">
    <div>
      <div class="brand text-center mb-4">
        <h4 class="fw-bold text-primary mb-0">Lavrix</h4>
        <small class="text-muted">User Panel</small>
      </div>
      <ul class="nav flex-column gap-2">
          <li><a href="#" class="nav-link active">Dashboard<i class="bi bi-speedometer2 me-2"></i></a></li>
        <hr>  
          <li><a href="#orders" class="nav-link">My Orders<i class="bi bi-bag-check me-2"></i></a></li>
          <li><a href="#wishlist" class="nav-link">Wishlist<i class="bi bi-heart me-2"></i></a></li>
          <li><a href="#account" class="nav-link">Account<i class="bi bi-person-gear me-2"></i></a></li>
          <li><a href="#support" class="nav-link">Support<i class="bi bi-life-preserver me-2"></i></a></li>

      </ul>
    </div>

    <div class="mt-4">
      <a href="{% url 'accounts:logout' %}" class="btn btn-outline-danger fw-semibold w-100 rounded-pill">
        <i class="bi bi-box-arrow-right me-2"></i> Logout
      </a>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main flex-grow-1 p-4 bg-light">
    <!-- HEADER -->
    <div class="d-flex flex-wrap justify-content-center align-items-center mb-4">
      <h3 class="fw-bold mb-0">Welcome, {{ user.first_name|default:user.username }}</h3>
    </div>

    <!-- STATS -->
    <div class="row g-3 mb-4">
      <div class="col-6 col-md-3">
        <div class="card stat shadow-sm border-0 rounded-4">
          <div class="card-body text-center">
            <div class="icon-circle bg-primary bg-opacity-10 text-primary"><i class="bi bi-graph-up"></i></div>
            <h6 class="text-muted mt-2">Total Orders</h6>
            <h3 class="fw-bold text-primary">{{ total_orders|default:25 }}</h3>
          </div>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="card stat shadow-sm border-0 rounded-4">
          <div class="card-body text-center">
            <div class="icon-circle bg-warning bg-opacity-10 text-warning"><i class="bi bi-hourglass-split"></i></div>
            <h6 class="text-muted mt-2">Pending</h6>
            <h3 class="fw-bold text-warning">{{ pending_orders|default:5 }}</h3>
          </div>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="card stat shadow-sm border-0 rounded-4">
          <div class="card-body text-center">
            <div class="icon-circle bg-success bg-opacity-10 text-success"><i class="bi bi-check-circle"></i></div>
            <h6 class="text-muted mt-2">Completed</h6>
            <h3 class="fw-bold text-success">{{ completed_orders|default:15 }}</h3>
          </div>
        </div>
      </div>

      <div id='wishlist' class="col-6 col-md-3">
        <div class="card stat shadow-sm border-0 rounded-4">
          <div class="card-body text-center">
            <div class="icon-circle bg-danger bg-opacity-10 text-danger"><i class="bi bi-heart"></i></div>
            <h6 class="text-muted mt-2">Wishlist</h6>
            <h3 class="fw-bold text-danger">{{ wishlist_count|default:8 }}</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- CHARTS -->
    <div class="row g-4 mb-5 equal-charts">
      <div class="col-lg-6">
        <div class="card shadow-sm rounded-4 h-100">
          <div class="card-body d-flex flex-column">
            <h6 class="fw-semibold text-secondary mb-3">Orders Over Time</h6>
            <canvas id="ordersChart" class="flex-grow-1"></canvas>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card shadow-sm rounded-4 h-100">
          <div class="card-body d-flex flex-column">
            <h6 class="fw-semibold text-secondary mb-3">Spending by Category</h6>
            <canvas id="spendingChart" class="flex-grow-1"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- ORDERS -->
    <section id="orders" class="mb-5">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h5 class="fw-semibold text-secondary mb-3"><i class="bi bi-bag-check me-2"></i>Recent Orders</h5>
          <div class="table-responsive">
            <table class="table align-middle table-hover">
              <thead class="table-light">
                <tr><th>ID</th><th>Items</th><th>Status</th><th>Date</th><th>Total</th></tr>
              </thead>
              <tbody>
                {% for order in recent_orders %}
                <tr>
                  <td>#{{ order.id }}</td>
                  <td>{{ order.total_items }}</td>
                  <td>
                    <span class="badge rounded-pill bg-{% if order.status == 'pending' %}warning{% elif order.status == 'delivered' %}success{% else %}secondary{% endif %}">
                      {{ order.status|title }}
                    </span>
                  </td>
                  <td>{{ order.created_at|date:"M d, Y" }}</td>
                  <td>${{ order.total_price }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="5" class="text-center text-muted py-3">No orders found</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ACCOUNT -->
    <section id="account" class="mb-5">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h5 class="fw-semibold text-secondary mb-3"><i class="bi bi-person-gear me-2"></i>Account Settings</h5>
          <form method="POST" action="{% url 'dashboard' %}">
            {% csrf_token %}
            <div class="row g-3">
              <div class="col-md-6"><label>First Name</label><input type="text" name="first_name" value="{{ user.first_name }}" class="form-control"></div>
              <div class="col-md-6"><label>Last Name</label><input type="text" name="last_name" value="{{ user.last_name }}" class="form-control"></div>
              <div class="col-md-6"><label>Email</label><input type="email" name="email" value="{{ user.email }}" class="form-control"></div>
              <div class="col-md-6"><label>New Password</label><input type="password" name="password" placeholder="••••••••" class="form-control"></div>
            </div>
            <div class="text-end mt-3"><button class="btn btn-primary rounded-pill">Save Changes</button></div>
          </form>
        </div>
      </div>
    </section>

    <!-- SUPPORT -->
    <section id="support" class="mb-5">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h5 class="fw-semibold text-secondary mb-3"><i class="bi bi-life-preserver me-2"></i>Support</h5>
            <a href="{% url 'support:ticket_create' %}"class="btn btn-warning rounded-pill"><i class="bi bi-send me-1"></i>Submit Ticket</a>
        </div>
      </div>
    </section>
  </main>
</div>

{% endblock %}






